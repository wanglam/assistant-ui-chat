"use client";
import{c as l,e as _,o as c}from"./chunk-IGSD7UZ4.mjs";var k=_((de,T)=>{"use strict";c();var O=Object.defineProperty,N=Object.getOwnPropertyDescriptor,C=Object.getOwnPropertyNames,U=Object.prototype.hasOwnProperty,F=(e,r)=>{for(var t in r)O(e,t,{get:r[t],enumerable:!0})},J=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of C(r))!U.call(e,o)&&o!==t&&O(e,o,{get:()=>r[o],enumerable:!(n=N(r,o))||n.enumerable});return e},M=e=>J(O({},"__esModule",{value:!0}),e),P={};F(P,{VercelOidcTokenError:()=>v});T.exports=M(P);var v=class extends Error{constructor(r,t){super(r),this.name="VercelOidcTokenError",this.cause=t}toString(){return this.cause?`${this.name}: ${this.message}: ${this.cause}`:`${this.name}: ${this.message}`}}});var x=_((_e,m)=>{"use strict";c();var q=Object.create,p=Object.defineProperty,R=Object.getOwnPropertyDescriptor,L=Object.getOwnPropertyNames,B=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty,H=(e,r)=>{for(var t in r)p(e,t,{get:r[t],enumerable:!0})},b=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of L(r))!G.call(e,o)&&o!==t&&p(e,o,{get:()=>r[o],enumerable:!(n=R(r,o))||n.enumerable});return e},h=(e,r,t)=>(t=e!=null?q(B(e)):{},b(r||!e||!e.__esModule?p(t,"default",{value:e,enumerable:!0}):t,e)),X=e=>b(p({},"__esModule",{value:!0}),e),E={};H(E,{findRootDir:()=>K,getUserDataDir:()=>Q});m.exports=X(E);var u=h(l("path")),z=h(l("fs")),y=h(l("os")),D=k();function K(){try{let e=process.cwd();for(;e!==u.default.dirname(e);){let r=u.default.join(e,".vercel");if(z.default.existsSync(r))return e;e=u.default.dirname(e)}}catch(e){throw new D.VercelOidcTokenError("Token refresh only supported in node server environments")}throw new D.VercelOidcTokenError("Unable to find root directory")}function Q(){if(process.env.XDG_DATA_HOME)return process.env.XDG_DATA_HOME;switch(y.default.platform()){case"darwin":return u.default.join(y.default.homedir(),"Library/Application Support");case"linux":return u.default.join(y.default.homedir(),".local/share");case"win32":return process.env.LOCALAPPDATA?process.env.LOCALAPPDATA:null;default:return null}}});var pe=_((Oe,$)=>{c();var W=Object.create,d=Object.defineProperty,Y=Object.getOwnPropertyDescriptor,Z=Object.getOwnPropertyNames,ee=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty,te=(e,r)=>{for(var t in r)d(e,t,{get:r[t],enumerable:!0})},V=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Z(r))!re.call(e,o)&&o!==t&&d(e,o,{get:()=>r[o],enumerable:!(n=Y(r,o))||n.enumerable});return e},S=(e,r,t)=>(t=e!=null?W(ee(e)):{},V(r||!e||!e.__esModule?d(t,"default",{value:e,enumerable:!0}):t,e)),oe=e=>V(d({},"__esModule",{value:!0}),e),A={};te(A,{assertVercelOidcTokenResponse:()=>w,findProjectInfo:()=>ie,getTokenPayload:()=>le,getVercelCliToken:()=>ne,getVercelDataDir:()=>I,getVercelOidcToken:()=>ae,isExpired:()=>ue,loadToken:()=>se,saveToken:()=>ce});$.exports=oe(A);var s=S(l("path")),a=S(l("fs")),i=k(),f=x();function I(){let e="com.vercel.cli",r=(0,f.getUserDataDir)();return r?s.join(r,e):null}function ne(){let e=I();if(!e)return null;let r=s.join(e,"auth.json");if(!a.existsSync(r))return null;let t=a.readFileSync(r,"utf8");return t?JSON.parse(t).token:null}async function ae(e,r,t){try{let n=`https://api.vercel.com/v1/projects/${r}/token?source=vercel-oidc-refresh${t?`&teamId=${t}`:""}`,o=await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${e}`}});if(!o.ok)throw new i.VercelOidcTokenError(`Failed to refresh OIDC token: ${o.statusText}`);let g=await o.json();return w(g),g}catch(n){throw new i.VercelOidcTokenError("Failed to refresh OIDC token",n)}}function w(e){if(!e||typeof e!="object")throw new TypeError("Expected an object");if(!("token"in e)||typeof e.token!="string")throw new TypeError("Expected a string-valued token property")}function ie(){let e=(0,f.findRootDir)();if(!e)throw new i.VercelOidcTokenError("Unable to find root directory");try{let r=s.join(e,".vercel","project.json");if(!a.existsSync(r))throw new i.VercelOidcTokenError("project.json not found");let t=JSON.parse(a.readFileSync(r,"utf8"));if(typeof t.projectId!="string"&&typeof t.orgId!="string")throw new TypeError("Expected a string-valued projectId property");return{projectId:t.projectId,teamId:t.orgId}}catch(r){throw new i.VercelOidcTokenError("Unable to find project ID",r)}}function ce(e,r){try{let t=(0,f.getUserDataDir)();if(!t)throw new i.VercelOidcTokenError("Unable to find user data directory");let n=s.join(t,"com.vercel.token",`${r}.json`),o=JSON.stringify(e);a.mkdirSync(s.dirname(n),{mode:504,recursive:!0}),a.writeFileSync(n,o),a.chmodSync(n,432);return}catch(t){throw new i.VercelOidcTokenError("Failed to save token",t)}}function se(e){try{let r=(0,f.getUserDataDir)();if(!r)return null;let t=s.join(r,"com.vercel.token",`${e}.json`);if(!a.existsSync(t))return null;let n=JSON.parse(a.readFileSync(t,"utf8"));return w(n),n}catch(r){throw new i.VercelOidcTokenError("Failed to load token",r)}}function le(e){let r=e.split(".");if(r.length!==3)throw new i.VercelOidcTokenError("Invalid token");let t=r[1].replace(/-/g,"+").replace(/_/g,"/"),n=t.padEnd(t.length+(4-t.length%4)%4,"=");return JSON.parse(Buffer.from(n,"base64").toString("utf8"))}function ue(e){return e.exp*1e3<Date.now()}});export{k as a,pe as b};
