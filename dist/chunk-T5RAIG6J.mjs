"use client";
import{c as s,e as f}from"./chunk-24KXR4MQ.mjs";var O=f((ue,j)=>{"use strict";var v=Object.defineProperty,I=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyNames,N=Object.prototype.hasOwnProperty,C=(e,r)=>{for(var t in r)v(e,t,{get:r[t],enumerable:!0})},U=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of $(r))!N.call(e,o)&&o!==t&&v(e,o,{get:()=>r[o],enumerable:!(n=I(r,o))||n.enumerable});return e},F=e=>U(v({},"__esModule",{value:!0}),e),g={};C(g,{VercelOidcTokenError:()=>_});j.exports=F(g);var _=class extends Error{constructor(r,t){super(r),this.name="VercelOidcTokenError",this.cause=t}toString(){return this.cause?`${this.name}: ${this.message}: ${this.cause}`:`${this.name}: ${this.message}`}}});var E=f((pe,b)=>{"use strict";var J=Object.create,u=Object.defineProperty,M=Object.getOwnPropertyDescriptor,q=Object.getOwnPropertyNames,R=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,B=(e,r)=>{for(var t in r)u(e,t,{get:r[t],enumerable:!0})},T=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of q(r))!L.call(e,o)&&o!==t&&u(e,o,{get:()=>r[o],enumerable:!(n=M(r,o))||n.enumerable});return e},y=(e,r,t)=>(t=e!=null?J(R(e)):{},T(r||!e||!e.__esModule?u(t,"default",{value:e,enumerable:!0}):t,e)),G=e=>T(u({},"__esModule",{value:!0}),e),D={};B(D,{findRootDir:()=>X,getUserDataDir:()=>z});b.exports=G(D);var l=y(s("path")),H=y(s("fs")),k=y(s("os")),P=O();function X(){try{let e=process.cwd();for(;e!==l.default.dirname(e);){let r=l.default.join(e,".vercel");if(H.default.existsSync(r))return e;e=l.default.dirname(e)}}catch(e){throw new P.VercelOidcTokenError("Token refresh only supported in node server environments")}throw new P.VercelOidcTokenError("Unable to find root directory")}function z(){if(process.env.XDG_DATA_HOME)return process.env.XDG_DATA_HOME;switch(k.default.platform()){case"darwin":return l.default.join(k.default.homedir(),"Library/Application Support");case"linux":return l.default.join(k.default.homedir(),".local/share");case"win32":return process.env.LOCALAPPDATA?process.env.LOCALAPPDATA:null;default:return null}}});var le=f((de,A)=>{var K=Object.create,p=Object.defineProperty,Q=Object.getOwnPropertyDescriptor,W=Object.getOwnPropertyNames,Y=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty,ee=(e,r)=>{for(var t in r)p(e,t,{get:r[t],enumerable:!0})},m=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of W(r))!Z.call(e,o)&&o!==t&&p(e,o,{get:()=>r[o],enumerable:!(n=Q(r,o))||n.enumerable});return e},x=(e,r,t)=>(t=e!=null?K(Y(e)):{},m(r||!e||!e.__esModule?p(t,"default",{value:e,enumerable:!0}):t,e)),re=e=>m(p({},"__esModule",{value:!0}),e),V={};ee(V,{assertVercelOidcTokenResponse:()=>h,findProjectInfo:()=>ne,getTokenPayload:()=>ce,getVercelCliToken:()=>te,getVercelDataDir:()=>S,getVercelOidcToken:()=>oe,isExpired:()=>se,loadToken:()=>ie,saveToken:()=>ae});A.exports=re(V);var c=x(s("path")),a=x(s("fs")),i=O(),d=E();function S(){let e="com.vercel.cli",r=(0,d.getUserDataDir)();return r?c.join(r,e):null}function te(){let e=S();if(!e)return null;let r=c.join(e,"auth.json");if(!a.existsSync(r))return null;let t=a.readFileSync(r,"utf8");return t?JSON.parse(t).token:null}async function oe(e,r,t){try{let n=`https://api.vercel.com/v1/projects/${r}/token?source=vercel-oidc-refresh${t?`&teamId=${t}`:""}`,o=await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${e}`}});if(!o.ok)throw new i.VercelOidcTokenError(`Failed to refresh OIDC token: ${o.statusText}`);let w=await o.json();return h(w),w}catch(n){throw new i.VercelOidcTokenError("Failed to refresh OIDC token",n)}}function h(e){if(!e||typeof e!="object")throw new TypeError("Expected an object");if(!("token"in e)||typeof e.token!="string")throw new TypeError("Expected a string-valued token property")}function ne(){let e=(0,d.findRootDir)();if(!e)throw new i.VercelOidcTokenError("Unable to find root directory");try{let r=c.join(e,".vercel","project.json");if(!a.existsSync(r))throw new i.VercelOidcTokenError("project.json not found");let t=JSON.parse(a.readFileSync(r,"utf8"));if(typeof t.projectId!="string"&&typeof t.orgId!="string")throw new TypeError("Expected a string-valued projectId property");return{projectId:t.projectId,teamId:t.orgId}}catch(r){throw new i.VercelOidcTokenError("Unable to find project ID",r)}}function ae(e,r){try{let t=(0,d.getUserDataDir)();if(!t)throw new i.VercelOidcTokenError("Unable to find user data directory");let n=c.join(t,"com.vercel.token",`${r}.json`),o=JSON.stringify(e);a.mkdirSync(c.dirname(n),{mode:504,recursive:!0}),a.writeFileSync(n,o),a.chmodSync(n,432);return}catch(t){throw new i.VercelOidcTokenError("Failed to save token",t)}}function ie(e){try{let r=(0,d.getUserDataDir)();if(!r)return null;let t=c.join(r,"com.vercel.token",`${e}.json`);if(!a.existsSync(t))return null;let n=JSON.parse(a.readFileSync(t,"utf8"));return h(n),n}catch(r){throw new i.VercelOidcTokenError("Failed to load token",r)}}function ce(e){let r=e.split(".");if(r.length!==3)throw new i.VercelOidcTokenError("Invalid token");let t=r[1].replace(/-/g,"+").replace(/_/g,"/"),n=t.padEnd(t.length+(4-t.length%4)%4,"=");return JSON.parse(Buffer.from(n,"base64").toString("utf8"))}function se(e){return e.exp*1e3<Date.now()}});export{O as a,le as b};
